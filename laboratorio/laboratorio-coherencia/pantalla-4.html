<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudio 2: Preferencia - Laboratorio de Coherencia</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Fraunces:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/mobile.css">
    <style>
        .experimento-eleccion {
            background: linear-gradient(135deg, #E6FFF9, #F0FFF9);
            border-radius: var(--radius-3xl);
            padding: var(--space-12);
            margin: var(--space-10) 0;
            border: 4px solid var(--acento-cyan);
        }

        .puertas-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-10);
            margin: var(--space-10) 0;
        }

        .puerta {
            background: white;
            border-radius: var(--radius-3xl);
            padding: var(--space-12);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: var(--shadow-xl);
            border: 4px solid transparent;
        }

        .puerta:hover:not(.forzada) {
            transform: translateY(-12px);
            box-shadow: var(--shadow-2xl);
        }

        .puerta.azul { border-color: #3B82F6; }
        .puerta.amarilla { border-color: #F59E0B; }
        .puerta.forzada { opacity: 0.5; cursor: not-allowed; }

        .puerta-emoji {
            font-size: 120px;
            margin: var(--space-6) 0;
            animation: float 3s ease-in-out infinite;
        }

        .puerta-label {
            font-family: var(--font-display);
            font-size: var(--text-3xl);
            font-weight: var(--font-black);
            margin-top: var(--space-4);
        }

        .puerta.azul .puerta-label { color: #3B82F6; }
        .puerta.amarilla .puerta-label { color: #F59E0B; }

        .mini-matching {
            background: white;
            border-radius: var(--radius-2xl);
            padding: var(--space-8);
            margin: var(--space-6) 0;
            display: none;
        }

        .mini-matching.show { display: block; }

        .mini-opciones {
            display: flex;
            gap: var(--space-4);
            justify-content: center;
            margin-top: var(--space-6);
        }

        .mini-opcion {
            padding: var(--space-6);
            background: var(--fondo-tarjeta-suave);
            border: 2px solid transparent;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            flex: 1;
            max-width: 150px;
        }

        .mini-opcion:hover {
            border-color: var(--acento-cyan);
            transform: scale(1.05);
            background: white;
        }

        .mini-opcion-emoji {
            font-size: 48px;
            display: block;
            margin-bottom: var(--space-2);
        }

        .feedback-eleccion {
            background: linear-gradient(135deg, #FFF9E6, #FFFAEB);
            border-radius: var(--radius-xl);
            padding: var(--space-6);
            margin-top: var(--space-6);
            text-align: center;
            display: none;
            color: var(--texto-oscuro);
            font-size: var(--text-lg);
        }

        .feedback-eleccion.show { 
            display: block;
            animation: fadeInUp 0.5s ease-out;
        }

        .resultados-preferencia {
            background: white;
            border-radius: var(--radius-3xl);
            padding: var(--space-12);
            margin: var(--space-10) 0;
            box-shadow: var(--shadow-2xl);
            display: none;
        }

        .resultados-preferencia.show { 
            display: block;
            animation: fadeInUp 0.8s ease-out;
        }

        .barra-visual {
            height: 60px;
            background: var(--fondo-tarjeta-suave);
            border-radius: var(--radius-lg);
            overflow: hidden;
            margin: var(--space-4) 0;
        }

        .barra-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 var(--space-4);
            font-size: var(--text-2xl);
            font-weight: var(--font-black);
            color: white;
            width: 0%;
            transition: width 1s ease-out;
        }

        .barra-fill.azul { background: linear-gradient(90deg, #3B82F6, #2563EB); }
        .barra-fill.amarilla { background: linear-gradient(90deg, #F59E0B, #D97706); }

        .ejemplo-titulo { color: var(--texto-oscuro); }

        @media (max-width: 768px) {
            .puertas-container { grid-template-columns: 1fr; }
            .mini-opciones { flex-direction: column; }
            .mini-opcion { max-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <button class="btn-volver" onclick="window.location.href='index.html'">
                <span>‚Üê</span>
                <span>Volver al inicio</span>
            </button>
            
            <div class="pill-progreso">
                <span class="pill-texto">Progreso</span>
                <div class="pill-barra">
                    <div class="pill-barra-fill" style="width: 50%;"></div>
                </div>
                <span class="pill-texto"><strong>4/8</strong></span>
            </div>
        </header>

        <div class="badge-modulo animate-fade-in delay-200">
            üö™ Estudio 2: ¬øPrefieres Tener Sentido?
        </div>

        <h1 class="text-gradient animate-fade-in delay-300">
            ¬øElegir√≠as la Coherencia Si Pudieras?
        </h1>

        <div class="tarjeta tarjeta-principal animate-fade-in-up delay-500">
            <div class="tarjeta-icono-grande animate-float">üéØ</div>
            <h2 class="tarjeta-titulo">La Pregunta Se Pone Interesante</h2>
            
            <p class="tarjeta-texto">
                El Estudio 1 mostr√≥ que las personas responden coherentemente incluso sin instrucciones. 
                Pero eso no prueba que la coherencia sea reforzante.
            </p>

            <div class="caja-info">
                <div class="caja-icono">ü§î</div>
                <div class="caja-contenido">
                    <h4>La Pregunta Crucial</h4>
                    <p style="font-size: var(--text-xl); color: var(--texto-oscuro);">
                        Si te doy a elegir entre un contexto coherente y otro incoherente... ¬øcu√°l preferir√≠as?
                    </p>
                </div>
            </div>

            <div class="ejemplo-didactico">
                <div class="ejemplo-titulo">
                    <span>üí°</span>
                    <span>Analog√≠a: El Rompecabezas</span>
                </div>
                <div class="ejemplo-contenido">
                    <div class="grid-2" style="gap: var(--space-6);">
                        <div style="background: linear-gradient(135deg, #D1FAE5, #A7F3D0); padding: var(--space-6); border-radius: var(--radius-lg);">
                            <h4 style="color: var(--texto-oscuro); font-weight: bold; margin-bottom: var(--space-3);">üß© Mesa A: Coherente</h4>
                            <p style="color: var(--texto-oscuro);">Todas las piezas encajan. Tiene sentido.</p>
                        </div>
                        <div style="background: linear-gradient(135deg, #FEE2E2, #FECACA); padding: var(--space-6); border-radius: var(--radius-lg);">
                            <h4 style="color: var(--texto-oscuro); font-weight: bold; margin-bottom: var(--space-3);">‚ùå Mesa B: Incoherente</h4>
                            <p style="color: var(--texto-oscuro);">Faltan piezas. Es frustrante.</p>
                        </div>
                    </div>
                </div>
            </div>

            <h3 class="tarjeta-titulo" style="margin-top: var(--space-16);">El Dise√±o Experimental</h3>
            
            <div class="grid-2" style="margin: var(--space-8) 0;">
                <div class="stat-card" style="border-top: 6px solid #3B82F6;">
                    <div class="stat-icono">üü¶</div>
                    <div class="stat-numero" style="color: #3B82F6;">Puerta Azul</div>
                    <div class="stat-label">Te lleva a trials COHERENTES</div>
                </div>
                <div class="stat-card" style="border-top: 6px solid #F59E0B;">
                    <div class="stat-icono">üü®</div>
                    <div class="stat-numero" style="color: #F59E0B;">Puerta Amarilla</div>
                    <div class="stat-label">Te lleva a trials INCOHERENTES</div>
                </div>
            </div>
        </div>

        <!-- EXPERIMENTO -->
        <div class="experimento-eleccion" id="experimento">
            <h3 style="text-align: center; font-size: var(--text-4xl); font-weight: var(--font-black); margin-bottom: var(--space-8);">
                üéÆ Experimenta la Elecci√≥n
            </h3>

            <div style="text-align: center; margin-bottom: var(--space-6);">
                <strong id="trialText" style="font-size: var(--text-xl);">Trial 1 de 10</strong>
            </div>

            <div style="text-align: center; margin-bottom: var(--space-8);">
                <div id="faseText" style="font-size: var(--text-2xl); font-weight: bold; color: var(--acento-cyan);">Fase: Elecci√≥n Libre</div>
                <div style="font-size: var(--text-lg); color: var(--texto-suave); margin-top: var(--space-2);">Elige la puerta que prefieras</div>
            </div>

            <div class="puertas-container">
                <div class="puerta azul" id="puertaAzul">
                    <div class="puerta-emoji">üü¶</div>
                    <div class="puerta-label">Puerta Azul</div>
                    <p style="color: var(--texto-suave); margin-top: var(--space-3);">Contexto coherente</p>
                </div>

                <div class="puerta amarilla" id="puertaAmarilla">
                    <div class="puerta-emoji">üü®</div>
                    <div class="puerta-label">Puerta Amarilla</div>
                    <p style="color: var(--texto-suave); margin-top: var(--space-3);">Contexto incoherente</p>
                </div>
            </div>

            <div class="mini-matching" id="miniMatching">
                <div style="text-align: center; margin-bottom: var(--space-6);">
                    <p style="font-size: var(--text-xl); font-weight: bold; color: var(--texto-oscuro);">Empareja esto:</p>
                    <div style="font-size: 80px; margin: var(--space-4) 0;" id="muestra"></div>
                    <p style="font-size: var(--text-lg); color: var(--texto-suave);" id="muestraLabel"></p>
                </div>
                <div class="mini-opciones" id="opciones"></div>
            </div>

            <div class="feedback-eleccion" id="feedback"></div>
        </div>

        <!-- RESULTADOS -->
        <div class="resultados-preferencia" id="resultados">
            <h3 class="tarjeta-titulo" style="text-align: center; margin-bottom: var(--space-10);">
                üìä Tus Resultados de Preferencia
            </h3>
            
            <div style="margin: var(--space-8) 0;">
                <div style="margin-bottom: var(--space-8);">
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-3); font-size: var(--text-lg); font-weight: bold;">
                        <span style="color: #3B82F6;">üü¶ Puerta Azul (Coherente)</span>
                        <span id="porcAzul">0%</span>
                    </div>
                    <div class="barra-visual">
                        <div class="barra-fill azul" id="barraAzul">
                            <span id="numAzul">0</span>
                        </div>
                    </div>
                </div>

                <div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: var(--space-3); font-size: var(--text-lg); font-weight: bold;">
                        <span style="color: #F59E0B;">üü® Puerta Amarilla (Incoherente)</span>
                        <span id="porcAmarilla">0%</span>
                    </div>
                    <div class="barra-visual">
                        <div class="barra-fill amarilla" id="barraAmarilla">
                            <span id="numAmarilla">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="caja-insight" style="margin-top: var(--space-10);">
                <div class="caja-icono">üí°</div>
                <div class="caja-contenido">
                    <h4>Interpretaci√≥n:</h4>
                    <p id="interpretacion" style="font-size: var(--text-lg);"></p>
                </div>
            </div>
        </div>

        <div class="tarjeta animate-fade-in-up delay-900">
            <h2 class="tarjeta-titulo">Hallazgos del Estudio Real</h2>
            
            <div class="grid-2" style="margin: var(--space-8) 0;">
                <div class="stat-card">
                    <div class="stat-icono">üìä</div>
                    <div class="stat-numero">39%</div>
                    <div class="stat-label">Pre-Rule: Prefirieron coherencia</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icono">üìà</div>
                    <div class="stat-numero">45%</div>
                    <div class="stat-label">Post-Rule: Prefirieron coherencia</div>
                </div>
            </div>

            <div class="caja-dato">
                <div class="caja-icono">üéØ</div>
                <div class="caja-contenido">
                    <h4>Hallazgo Clave #3</h4>
                    <p>
                        Hubo diferencia significativa entre quienes eligieron coherencia vs incoherencia. 
                        Cuando los participantes pod√≠an discriminar claramente, <strong>eligieron coherencia 
                        sobre incoherencia</strong> (p < .001).
                    </p>
                </div>
            </div>
        </div>

        <div class="navegacion animate-fade-in delay-1200">
            <button class="btn btn-secundario" onclick="window.location.href='pantalla-3.html'">
                <span>‚Üê</span>
                <span>Anterior</span>
            </button>
            <button class="btn btn-primario" onclick="window.location.href='pantalla-5.html'">
                <span>Siguiente: El Costo</span>
                <span>‚Üí</span>
            </button>
        </div>
    </div>

    <script src="js/main.js"></script>
    <script>
        // ============================================
        // EXPERIMENTO INLINE - SIMPLE Y FUNCIONAL
        // ============================================
        
        const emojis = {
            'B1': '‚≠ê', 'B2': '‚ù§Ô∏è', 'B3': 'üî∂',
            'C1': 'üìê', 'C2': 'üî∫', 'C3': '‚≠ï',
            'A2': 'üîµ'
        };

        let trial = 0;
        let elecciones = [];
        
        // 5 libres, 4 forzadas azul, 1 forzada amarilla
        let trials = [
            'libre', 'forzada-azul', 'libre', 'forzada-azul', 
            'libre', 'forzada-amarilla', 'libre', 'forzada-azul',
            'libre', 'forzada-azul'
        ];

        function iniciar() {
            console.log('‚úÖ Experimento Pantalla 4 iniciado');
            mostrarTrial();
            
            // Agregar eventos a las puertas
            document.getElementById('puertaAzul').onclick = function() {
                if (!this.classList.contains('forzada')) {
                    elegir('azul');
                }
            };
            
            document.getElementById('puertaAmarilla').onclick = function() {
                if (!this.classList.contains('forzada')) {
                    elegir('amarilla');
                }
            };
        }

        function mostrarTrial() {
            if (trial >= 10) {
                finalizar();
                return;
            }

            console.log(`Trial ${trial + 1}: ${trials[trial]}`);
            
            document.getElementById('trialText').textContent = `Trial ${trial + 1} de 10`;
            document.getElementById('miniMatching').classList.remove('show');
            document.getElementById('feedback').classList.remove('show');

            const tipo = trials[trial];
            const azul = document.getElementById('puertaAzul');
            const amarilla = document.getElementById('puertaAmarilla');
            const faseText = document.getElementById('faseText');

            // Resetear
            azul.classList.remove('forzada');
            amarilla.classList.remove('forzada');

            if (tipo === 'forzada-azul') {
                amarilla.classList.add('forzada');
                faseText.textContent = 'Fase: Forzada (Azul)';
                setTimeout(() => elegir('azul'), 1500);
            } else if (tipo === 'forzada-amarilla') {
                azul.classList.add('forzada');
                faseText.textContent = 'Fase: Forzada (Amarilla)';
                setTimeout(() => elegir('amarilla'), 1500);
            } else {
                faseText.textContent = 'Fase: Elecci√≥n Libre';
            }
        }

        function elegir(puerta) {
            console.log(`Elegiste: ${puerta}`);
            
            const esForzada = trials[trial].includes('forzada');
            elecciones.push({ puerta, forzada: esForzada });
            
            const esCoherente = puerta === 'azul';
            const muestras = ['B1', 'B2', 'B3'];
            const muestra = muestras[Math.floor(Math.random() * 3)];
            
            let opciones;
            if (esCoherente) {
                opciones = ['C1', 'C2', 'C3'];
            } else {
                // Incoherente: falta la correcta
                const num = muestra[1]; // '1', '2', o '3'
                opciones = ['C1', 'C2', 'C3'].filter(c => c !== 'C' + num);
                opciones.push('A2');
            }

            // Shuffle
            opciones.sort(() => Math.random() - 0.5);

            document.getElementById('muestra').textContent = emojis[muestra];
            document.getElementById('muestraLabel').textContent = muestra;
            
            const opcionesHTML = opciones.map(op => 
                `<div class="mini-opcion" onclick="responder()">
                    <div class="mini-opcion-emoji">${emojis[op]}</div>
                    <div style="font-weight: bold; font-size: var(--text-lg);">${op}</div>
                </div>`
            ).join('');
            
            document.getElementById('opciones').innerHTML = opcionesHTML;
            document.getElementById('miniMatching').classList.add('show');
            
            // Scroll suave
            setTimeout(() => {
                document.getElementById('miniMatching').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 100);
        }

        function responder() {
            console.log('Respondiste al matching');
            
            const ultimaEleccion = elecciones[elecciones.length - 1];
            const puerta = ultimaEleccion.puerta;
            const color = puerta === 'azul' ? '#3B82F6' : '#F59E0B';
            const nombre = puerta === 'azul' ? 'Azul' : 'Amarilla';
            const tipo = puerta === 'azul' ? 'coherentemente' : 'incoherentemente';

            document.getElementById('feedback').innerHTML = `
                <div style="margin-bottom: var(--space-6);">
                    Elegiste la <strong style="color: ${color};">Puerta ${nombre}</strong> üü¶ 
                    y pudiste responder ${tipo}.
                </div>
                <button class="btn btn-cyan" onclick="siguiente()" style="font-size: var(--text-lg); padding: var(--space-4) var(--space-8);">
                    Continuar ‚Üí
                </button>
            `;
            document.getElementById('feedback').classList.add('show');
            
            // Scroll al feedback
            setTimeout(() => {
                document.getElementById('feedback').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }, 100);
        }

        function siguiente() {
            trial++;
            mostrarTrial();
        }

        function finalizar() {
            console.log('üèÅ Experimento finalizado');
            console.log('Elecciones:', elecciones);
            
            document.getElementById('experimento').style.display = 'none';
            
            const libres = elecciones.filter(e => !e.forzada);
            const azul = libres.filter(e => e.puerta === 'azul').length;
            const amarilla = libres.length - azul;
            const porcAzul = libres.length > 0 ? (azul / libres.length) * 100 : 0;
            const porcAmarilla = 100 - porcAzul;

            console.log(`Resultados: Azul=${azul}, Amarilla=${amarilla}, %Azul=${porcAzul}`);

            // Animar barras
            setTimeout(() => {
                document.getElementById('barraAzul').style.width = porcAzul + '%';
                document.getElementById('barraAmarilla').style.width = porcAmarilla + '%';
            }, 500);

            document.getElementById('numAzul').textContent = azul;
            document.getElementById('numAmarilla').textContent = amarilla;
            document.getElementById('porcAzul').textContent = Math.round(porcAzul) + '%';
            document.getElementById('porcAmarilla').textContent = Math.round(porcAmarilla) + '%';

            let texto;
            if (porcAzul > 60) {
                texto = `Mostraste una <strong>clara preferencia por la coherencia</strong> (${Math.round(porcAzul)}%). 
                         Esto coincide con los participantes del estudio que prefirieron contextos coherentes.`;
            } else if (porcAzul >= 40) {
                texto = `Tu preferencia fue <strong>moderada hacia la coherencia</strong> (${Math.round(porcAzul)}%). 
                         Esto es similar al 39-45% del estudio real.`;
            } else {
                texto = `No mostraste una preferencia clara hacia la coherencia (${Math.round(porcAzul)}%). 
                         Esto tambi√©n ocurri√≥ en el estudio real con algunos participantes.`;
            }

            document.getElementById('interpretacion').innerHTML = texto;
            document.getElementById('resultados').classList.add('show');
            
            // Scroll a resultados
            setTimeout(() => {
                document.getElementById('resultados').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 800);
        }

        // INICIAR CUANDO CARGUE LA P√ÅGINA
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', iniciar);
        } else {
            iniciar();
        }
    </script>
</body>
</html>
