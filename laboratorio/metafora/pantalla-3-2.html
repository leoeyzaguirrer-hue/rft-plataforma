<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso Integrador Final | Lab Met√°foras</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #1B5E20;
            --bg-dark-2: #2E7D32;
            --bg-dark-3: #388E3C;
            
            --card-lavender: #F3E5F5;
            
            --accent-purple: #AB47BC;
            --accent-purple-dark: #8E24AA;
            --accent-purple-light: #CE93D8;
            
            --color-correct: #4CAF50;
            --color-partial: #FF9800;
            --color-wrong: #F44336;
            
            --text-dark: #1B1B1B;
            --text-white: #FFFFFF;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-dark-2) 50%, var(--bg-dark-3) 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
            color: var(--text-white);
            padding-bottom: 40px;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header {
            position: sticky;
            top: 0;
            background: rgba(27, 94, 32, 0.95);
            backdrop-filter: blur(10px);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            border-bottom: 2px solid rgba(171, 71, 188, 0.3);
        }

        .back-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:active {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(0.95);
        }

        .progress-indicator {
            font-size: 13px;
            font-weight: 700;
            opacity: 0.9;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 24px 20px;
        }

        .title-section {
            text-align: center;
            margin-bottom: 32px;
        }

        .part-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-purple-dark));
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 16px;
        }

        h1 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 12px;
            line-height: 1.2;
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }

        .theory-card {
            background: var(--card-lavender);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .theory-card p {
            color: var(--text-dark);
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 12px;
        }

        .theory-card p:last-child {
            margin-bottom: 0;
        }

        .theory-card strong {
            color: var(--accent-purple-dark);
        }

        /* Case Presentation */
        .case-card {
            background: var(--card-lavender);
            border-radius: 20px;
            padding: 28px 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        .case-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .case-emoji {
            font-size: 48px;
        }

        .case-title {
            color: var(--text-dark);
            font-size: 22px;
            font-weight: 800;
        }

        .case-info {
            background: rgba(171, 71, 188, 0.08);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }

        .case-info p {
            color: var(--text-dark);
            font-size: 15px;
            line-height: 1.7;
            margin-bottom: 10px;
        }

        .case-info p:last-child {
            margin-bottom: 0;
        }

        /* Decision Sections */
        .decision-section {
            background: var(--card-lavender);
            border-radius: 20px;
            padding: 28px 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .decision-section.active {
            opacity: 1;
            pointer-events: all;
        }

        .decision-section.completed {
            opacity: 1;
            pointer-events: none;
            border: 3px solid var(--color-correct);
        }

        .decision-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .decision-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-purple-dark));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 20px;
        }

        .decision-title {
            color: var(--text-dark);
            font-size: 20px;
            font-weight: 800;
            flex: 1;
        }

        .decision-prompt {
            color: var(--text-dark);
            font-size: 15px;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        /* Options */
        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option-btn {
            background: white;
            border: 3px solid var(--accent-purple-light);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }

        .option-btn:active {
            transform: scale(0.98);
        }

        .option-btn.selected {
            border-color: var(--accent-purple);
            background: rgba(171, 71, 188, 0.1);
        }

        .option-btn.correct {
            border-color: var(--color-correct);
            background: rgba(76, 175, 80, 0.1);
        }

        .option-btn.partial {
            border-color: var(--color-partial);
            background: rgba(255, 152, 0, 0.05);
        }

        .option-btn.wrong {
            border-color: var(--color-wrong);
            background: rgba(244, 67, 54, 0.05);
        }

        .option-content {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }

        .option-letter {
            width: 32px;
            height: 32px;
            background: var(--accent-purple-light);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 16px;
            flex-shrink: 0;
        }

        .option-text {
            color: var(--text-dark);
            font-size: 15px;
            font-weight: 600;
            flex: 1;
            line-height: 1.5;
        }

        .option-feedback {
            display: none;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid rgba(0, 0, 0, 0.1);
            color: var(--text-dark);
            font-size: 14px;
            line-height: 1.6;
        }

        .option-btn.selected .option-feedback {
            display: block;
        }

        .feedback-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 800;
            margin-bottom: 8px;
            color: white;
        }

        .feedback-badge.correct { background: var(--color-correct); }
        .feedback-badge.partial { background: var(--color-partial); }
        .feedback-badge.wrong { background: var(--color-wrong); }

        /* Text Input */
        .text-input-container {
            margin-bottom: 16px;
        }

        .text-input {
            width: 100%;
            padding: 14px;
            border: 3px solid var(--accent-purple-light);
            border-radius: 12px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--accent-purple);
        }

        /* Checklist Styles */
        .checklist-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 16px;
            background: white;
            border: 2px solid var(--accent-purple-light);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .checklist-item:hover {
            border-color: var(--accent-purple);
            background: rgba(171, 71, 188, 0.05);
        }

        .checklist-item input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .checkbox-custom {
            width: 24px;
            height: 24px;
            border: 3px solid var(--accent-purple-light);
            border-radius: 6px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .checklist-item input[type="checkbox"]:checked + .checkbox-custom {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
        }

        .checklist-item input[type="checkbox"]:checked + .checkbox-custom::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 16px;
            font-weight: 800;
        }

        .checklist-item.result-correct {
            border-color: var(--color-correct);
            background: rgba(76, 175, 80, 0.05);
        }

        .checklist-item.result-wrong {
            border-color: var(--color-wrong);
            background: rgba(244, 67, 54, 0.05);
        }

        .checklist-item.result-missed {
            border-color: var(--color-partial);
            background: rgba(255, 152, 0, 0.05);
        }

        .checklist-text {
            color: var(--text-dark);
            font-size: 15px;
            line-height: 1.6;
            flex: 1;
        }

        .result-icon {
            display: none;
            font-size: 20px;
            flex-shrink: 0;
        }

        .checklist-item.result-correct .result-icon,
        .checklist-item.result-wrong .result-icon,
        .checklist-item.result-missed .result-icon {
            display: block;
        }

        .submit-btn {
            width: 100%;
            padding: 14px 20px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-purple-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Score Card */
        .score-card {
            background: var(--card-lavender);
            border-radius: 20px;
            padding: 32px 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            text-align: center;
            display: none;
        }

        .score-card.show {
            display: block;
        }

        .score-emoji {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .score-title {
            color: var(--text-dark);
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 12px;
        }

        .score-number {
            font-size: 48px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-purple-dark));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 16px;
        }

        .score-message {
            color: var(--text-dark);
            font-size: 16px;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .score-breakdown {
            background: rgba(171, 71, 188, 0.08);
            padding: 16px;
            border-radius: 12px;
            text-align: left;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .breakdown-item:last-child {
            border-bottom: none;
        }

        .breakdown-label {
            color: var(--text-dark);
            font-size: 14px;
            font-weight: 600;
        }

        .breakdown-points {
            color: var(--accent-purple-dark);
            font-size: 16px;
            font-weight: 800;
        }

        .progress-dots {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 32px 0 24px;
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .dot.active {
            background: var(--accent-purple-light);
            width: 24px;
            border-radius: 5px;
        }

        .cta-button {
            width: 100%;
            padding: 18px 24px;
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-purple-dark));
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(171, 71, 188, 0.4);
            transition: all 0.3s ease;
            display: none;
        }

        .cta-button.show {
            display: block;
        }

        .cta-button:active {
            transform: translateY(2px);
            box-shadow: 0 4px 12px rgba(171, 71, 188, 0.3);
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn" onclick="window.location.href='pantalla-3-1.html'">‚óÑ Atr√°s</button>
        <div class="progress-indicator">Pantalla 8 de 8</div>
    </div>

    <div class="container">
        <div class="title-section">
            <span class="part-badge">üéØ Ejercicio Final</span>
            <h1>Caso Integrador</h1>
            <p class="subtitle">Crea una met√°fora cl√≠nica completa</p>
        </div>

        <!-- Instructions -->
        <div class="theory-card">
            <p>
                <strong>Instrucciones:</strong> Vas a crear una met√°fora cl√≠nica para un caso real 
                aplicando TODO lo que aprendiste.
            </p>
            <p>
                Tomar√°s <strong>4 decisiones</strong> que ser√°n evaluadas. 
                Al final recibir√°s tu puntaje y feedback personalizado.
            </p>
        </div>

        <!-- Case Presentation -->
        <div class="case-card">
            <div class="case-header">
                <span class="case-emoji">üë®‚Äçüíº</span>
                <h2 class="case-title">Caso: Roberto</h2>
            </div>

            <div class="case-info">
                <p><strong>Perfil:</strong> Roberto, 42 a√±os, ejecutivo de marketing</p>
                <p><strong>Motivo de consulta:</strong> Agotamiento extremo, problemas de sue√±o, irritabilidad</p>
                <p><strong>Patr√≥n principal:</strong> Trabaja 12-14 horas diarias incluyendo fines de semana. 
                No puede "desconectarse". Revisa emails constantemente. Siente que "si para, todo se derrumba".</p>
                <p><strong>Consecuencias:</strong> Relaci√≥n deteriorada con su familia, agotamiento f√≠sico, 
                sensaci√≥n de vac√≠o a pesar de "logros". Cuanto m√°s trabaja, m√°s trabajo encuentra.</p>
                <p><strong>Contexto importante:</strong> Es corredor amateur. Sol√≠a correr maratones.</p>
            </div>
        </div>

        <!-- Decision 1: TARGET -->
        <div class="decision-section active" id="decision1">
            <div class="decision-header">
                <div class="decision-number">1</div>
                <h3 class="decision-title">Identifica la META (Target)</h3>
            </div>
            <p class="decision-prompt">
                ¬øQu√© fen√≥meno deber√≠a ser la META de tu met√°fora? 
                Recuerda: debe ser funcionalmente relevante para Roberto.
            </p>

            <div class="options-container">
                <button class="option-btn" onclick="selectOption(1, 'A', 3)">
                    <div class="option-content">
                        <div class="option-letter">A</div>
                        <div class="option-text">Su patr√≥n de trabajar excesivamente sin poder parar</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge correct">‚úì EXCELENTE (3 puntos)</span>
                        <p>
                            Esta es la conducta funcionalmente relevante. Es observable, recurrente, 
                            y es lo que mantiene sus problemas. Perfecta elecci√≥n de META.
                        </p>
                    </div>
                </button>

                <button class="option-btn" onclick="selectOption(1, 'B', 1)">
                    <div class="option-content">
                        <div class="option-letter">B</div>
                        <div class="option-text">Su sensaci√≥n de vac√≠o y agotamiento</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge partial">~ PARCIAL (1 punto)</span>
                        <p>
                            Esto es una CONSECUENCIA, no la conducta problem√°tica. 
                            Aunque importante, no es la mejor META porque es resultado del patr√≥n, no el patr√≥n mismo.
                        </p>
                    </div>
                </button>

                <button class="option-btn" onclick="selectOption(1, 'C', 0)">
                    <div class="option-content">
                        <div class="option-letter">C</div>
                        <div class="option-text">Su miedo a que "todo se derrumbe"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge wrong">‚úó NO RECOMENDABLE (0 puntos)</span>
                        <p>
                            Este es el ANTECEDENTE (lo que dispara), no la conducta. 
                            Adem√°s, es un evento privado dif√≠cil de observar. La META debe ser la conducta visible.
                        </p>
                    </div>
                </button>
            </div>
        </div>

        <!-- Decision 2: SOURCE -->
        <div class="decision-section" id="decision2">
            <div class="decision-header">
                <div class="decision-number">2</div>
                <h3 class="decision-title">Elige el VEH√çCULO (Source)</h3>
            </div>
            <p class="decision-prompt">
                ¬øQu√© VEH√çCULO usar√≠as para iluminar "trabajar excesivamente sin parar"? 
                Considera los 3 principios.
            </p>

            <div class="options-container">
                <button class="option-btn" onclick="selectOption(2, 'A', 4)">
                    <div class="option-content">
                        <div class="option-letter">A</div>
                        <div class="option-text">"Correr una marat√≥n sin l√≠nea de meta"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge correct">‚úì PERFECTA (4 puntos)</span>
                        <p>
                            ‚úÖ Funcionalmente relevante: Captura el patr√≥n<br>
                            ‚úÖ Resuena: Roberto es corredor de maratones<br>
                            ‚úÖ Propiedad saliente: "Sin meta" = nunca termina, agotamiento inevitable<br><br>
                            üí° Esta met√°fora usa su identidad (corredor) para mostrar el absurdo de correr infinitamente.
                        </p>
                    </div>
                </button>

                <button class="option-btn" onclick="selectOption(2, 'B', 2)">
                    <div class="option-content">
                        <div class="option-letter">B</div>
                        <div class="option-text">"Motor sobrecalentado que no se apaga"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge partial">~ ACEPTABLE (2 puntos)</span>
                        <p>
                            ‚úÖ Funcionalmente relevante<br>
                            ‚ö†Ô∏è Resuena moderadamente: Es gen√©rico<br>
                            ‚úÖ Propiedad saliente: "Sobrecalentado" = consecuencia clara<br><br>
                            No es mala, pero no usa informaci√≥n espec√≠fica de Roberto (corredor).
                        </p>
                    </div>
                </button>

                <button class="option-btn" onclick="selectOption(2, 'C', 0)">
                    <div class="option-content">
                        <div class="option-letter">C</div>
                        <div class="option-text">"Eres como una vela que se consume"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge wrong">‚úó D√âBIL (0 puntos)</span>
                        <p>
                            ‚ö†Ô∏è Funcionalmente relevante: D√©bil, no captura el patr√≥n activo<br>
                            ‚ùå No resuena: Demasiado po√©tica, no conecta con Roberto<br>
                            ‚ùå Propiedad poco saliente: "Consumirse" es pasivo<br><br>
                            Esta met√°fora no tiene "bite" cl√≠nico.
                        </p>
                    </div>
                </button>
            </div>
        </div>

        <!-- Decision 3: 3 Principles Checklist -->
        <div class="decision-section" id="decision3">
            <div class="decision-header">
                <div class="decision-number">3</div>
                <h3 class="decision-title">Eval√∫a: ¬øPor qu√© funciona?</h3>
            </div>
            <p class="decision-prompt">
                Marca <strong>TODAS</strong> las afirmaciones correctas sobre la met√°fora 
                "Correr una marat√≥n sin l√≠nea de meta" con Roberto.
            </p>

            <div class="checklist-container">
                <label class="checklist-item">
                    <input type="checkbox" value="correct" data-id="1">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">La META es funcionalmente relevante porque trabajar excesivamente es el patr√≥n que mantiene sus problemas</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="correct" data-id="2">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">El VEH√çCULO resuena porque Roberto es corredor de maratones</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="correct" data-id="3">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">La propiedad "sin meta" es m√°s saliente que simplemente decir "trabajas mucho"</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="wrong" data-id="4">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">Esta met√°fora funciona con cualquier cliente independiente de su contexto</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="correct" data-id="5">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">"Sin l√≠nea de meta" muestra claramente que nunca termina = agotamiento inevitable</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="wrong" data-id="6">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">No importa si Roberto corre o no, la met√°fora funciona igual de bien</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="correct" data-id="7">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">Usar su identidad (corredor) hace la met√°fora m√°s poderosa y personalizada</span>
                </label>

                <label class="checklist-item">
                    <input type="checkbox" value="wrong" data-id="8">
                    <span class="checkbox-custom"></span>
                    <span class="checklist-text">La met√°fora solo necesita "sonar bien" para ser efectiva cl√≠nicamente</span>
                </label>
            </div>

            <button class="submit-btn" onclick="submitChecklist()">Validar Respuestas</button>
            
            <div class="option-feedback" id="principles-feedback" style="display: none; margin-top: 16px; padding-top: 16px; border-top: 2px solid rgba(0,0,0,0.1);">
                <span class="feedback-badge correct" id="principles-badge">‚úì EVALUADO</span>
                <p id="principles-result"></p>
            </div>
        </div>

        <!-- Decision 4: Shifting -->
        <div class="decision-section" id="decision4">
            <div class="decision-header">
                <div class="decision-number">4</div>
                <h3 class="decision-title">Aplica: Shifting</h3>
            </div>
            <p class="decision-prompt">
                Roberto menciona que tambi√©n: revisa emails compulsivamente, 
                no puede relajarse en vacaciones, y se siente culpable cuando descansa.
                <br><br>
                ¬øC√≥mo aplicar√≠as la met√°fora de "marat√≥n sin meta" a estas conductas?
            </p>

            <div class="options-container">
                <button class="option-btn" onclick="selectOption(4, 'A', 3)">
                    <div class="option-content">
                        <div class="option-letter">A</div>
                        <div class="option-text">"¬øTambi√©n est√°s corriendo sin meta con los emails? ¬øY en vacaciones sigues corriendo?"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge correct">‚úì EXCELENTE (3 puntos)</span>
                        <p>
                            Perfecto shifting. Usas la MISMA met√°fora para revelar que m√∫ltiples conductas 
                            (trabajo, emails, vacaciones) tienen la misma funci√≥n: correr sin parar.
                            <br><br>
                            Roberto puede ver el patr√≥n general de su vida.
                        </p>
                    </div>
                </button>

                <button class="option-btn" onclick="selectOption(4, 'B', 1)">
                    <div class="option-content">
                        <div class="option-letter">B</div>
                        <div class="option-text">"Los emails son otra fuente de estr√©s que debes evitar"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge partial">~ NO USA MET√ÅFORA (1 punto)</span>
                        <p>
                            Aunque es v√°lido, perdiste la oportunidad de usar la met√°fora establecida. 
                            El shifting es usar el MISMO veh√≠culo para m√∫ltiples metas relacionadas.
                        </p>
                    </div>
                </button>

                <button class="option-btn" onclick="selectOption(4, 'C', 0)">
                    <div class="option-content">
                        <div class="option-letter">C</div>
                        <div class="option-text">"Necesitas crear met√°foras nuevas para cada problema"</div>
                    </div>
                    <div class="option-feedback">
                        <span class="feedback-badge wrong">‚úó INCORRECTO (0 puntos)</span>
                        <p>
                            No. El shifting es precisamente lo OPUESTO: usar la MISMA met√°fora 
                            para revelar que diferentes conductas tienen la misma funci√≥n.
                        </p>
                    </div>
                </button>
            </div>
        </div>

        <!-- Score Card -->
        <div class="score-card" id="scoreCard">
            <div class="score-emoji" id="scoreEmoji">üéâ</div>
            <h2 class="score-title">Tu Puntuaci√≥n Final</h2>
            <div class="score-number"><span id="totalScore">0</span> / 13</div>
            <p class="score-message" id="scoreMessage"></p>
            
            <div class="score-breakdown">
                <div class="breakdown-item">
                    <span class="breakdown-label">1. Identificar META</span>
                    <span class="breakdown-points" id="score1">0 / 3</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">2. Elegir VEH√çCULO</span>
                    <span class="breakdown-points" id="score2">0 / 4</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">3. Aplicar 3 Principios</span>
                    <span class="breakdown-points" id="score3">0 / 3</span>
                </div>
                <div class="breakdown-item">
                    <span class="breakdown-label">4. Usar Shifting</span>
                    <span class="breakdown-points" id="score4">0 / 3</span>
                </div>
            </div>
        </div>

        <div class="progress-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot active"></div>
        </div>

        <button class="cta-button" id="finalBtn" onclick="nextModule()">
            Siguiente: An√°lisis Funcional con Met√°foras ‚Üí
        </button>
    </div>

    <script>
        let scores = [0, 0, 0, 0];
        let currentDecision = 1;

        function selectOption(decisionNum, option, points) {
            const section = document.getElementById(`decision${decisionNum}`);
            const buttons = section.querySelectorAll('.option-btn');
            
            buttons.forEach(btn => {
                btn.classList.remove('selected');
                const letter = btn.querySelector('.option-letter').textContent;
                if (points === 4 || points === 3) btn.classList.add('correct');
                else if (points === 2 || points === 1) btn.classList.add('partial');
                else btn.classList.add('wrong');
            });
            
            event.currentTarget.classList.add('selected');
            
            scores[decisionNum - 1] = points;
            document.getElementById(`score${decisionNum}`).textContent = `${points} / ${decisionNum === 2 ? 4 : 3}`;
            
            if (navigator.vibrate) {
                navigator.vibrate(points >= 2 ? [30, 50, 30] : 50);
            }
            
            setTimeout(() => {
                section.classList.remove('active');
                section.classList.add('completed');
                
                if (decisionNum < 4) {
                    if (decisionNum === 2) {
                        document.getElementById('decision3').classList.add('active');
                    } else {
                        const nextSection = document.getElementById(`decision${decisionNum + 1}`);
                        if (nextSection) {
                            nextSection.classList.add('active');
                            nextSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }
                }
            }, 2000);
        }

        function submitChecklist() {
            const checkboxes = document.querySelectorAll('.checklist-item input[type="checkbox"]');
            let correctChecked = 0;
            let wrongChecked = 0;
            let correctMissed = 0;
            
            checkboxes.forEach((checkbox, index) => {
                const item = checkbox.closest('.checklist-item');
                const isCorrect = checkbox.value === 'correct';
                const isChecked = checkbox.checked;
                
                // Remove previous result classes
                item.classList.remove('result-correct', 'result-wrong', 'result-missed');
                
                // Remove previous result icon if exists
                const oldIcon = item.querySelector('.result-icon');
                if (oldIcon) oldIcon.remove();
                
                // Add result icon
                const icon = document.createElement('span');
                icon.className = 'result-icon';
                
                if (isCorrect && isChecked) {
                    // Correct answer checked
                    item.classList.add('result-correct');
                    icon.textContent = '‚úì';
                    correctChecked++;
                } else if (!isCorrect && isChecked) {
                    // Wrong answer checked
                    item.classList.add('result-wrong');
                    icon.textContent = '‚úó';
                    wrongChecked++;
                } else if (isCorrect && !isChecked) {
                    // Correct answer missed
                    item.classList.add('result-missed');
                    icon.textContent = '!';
                    correctMissed++;
                }
                
                item.appendChild(icon);
                checkbox.disabled = true;
            });
            
            // Calculate points
            let points = 0;
            let feedback = '';
            const totalCorrect = 5;
            
            if (correctChecked === 5 && wrongChecked === 0) {
                points = 3;
                feedback = '¬°PERFECTO! Identificaste las 5 afirmaciones correctas y evitaste todas las trampas. Dominas los 3 principios.';
            } else if (correctChecked === 4 && wrongChecked === 0) {
                points = 2;
                feedback = `MUY BIEN. Identificaste 4 de 5 correctas sin marcar trampas. Te falt√≥ identificar ${correctMissed} afirmaci√≥n correcta.`;
            } else if (correctChecked >= 3 && wrongChecked <= 1) {
                points = 2;
                feedback = `BIEN. Marcaste ${correctChecked} correctas, pero tambi√©n marcaste ${wrongChecked} trampa${wrongChecked > 1 ? 's' : ''}. Revisa los 3 principios.`;
            } else if (correctChecked >= 3 && wrongChecked >= 2) {
                points = 1;
                feedback = `ACEPTABLE. Identificaste ${correctChecked} correctas, pero marcaste ${wrongChecked} trampas. Necesitas repasar qu√© hace efectiva una met√°fora.`;
            } else {
                points = 1;
                feedback = `INSUFICIENTE. Solo identificaste ${correctChecked} de 5 correctas y marcaste ${wrongChecked} trampas. Repasa: META relevante, VEH√çCULO resuena, propiedad saliente.`;
            }
            
            scores[2] = points;
            document.getElementById('score3').textContent = `${points} / 3`;
            
            const badge = document.getElementById('principles-badge');
            badge.className = points === 3 ? 'feedback-badge correct' : (points === 2 ? 'feedback-badge partial' : 'feedback-badge wrong');
            badge.textContent = points === 3 ? '‚úì PERFECTO' : (points === 2 ? '~ BIEN' : '‚ö†Ô∏è ACEPTABLE');
            
            document.getElementById('principles-result').innerHTML = `
                <strong>${feedback}</strong><br><br>
                ‚úì Correctas marcadas: ${correctChecked}<br>
                ‚úó Trampas marcadas: ${wrongChecked}<br>
                ! Correctas perdidas: ${correctMissed}<br><br>
                <em>Las 5 afirmaciones correctas cubren los 3 principios:</em><br>
                ‚Ä¢ Principio 1: META funcionalmente relevante<br>
                ‚Ä¢ Principio 2: VEH√çCULO resuena con el cliente<br>
                ‚Ä¢ Principio 3: Propiedad saliente en el VEH√çCULO
            `;
            
            document.getElementById('principles-feedback').style.display = 'block';
            
            // Disable submit button
            event.target.disabled = true;
            event.target.style.opacity = '0.5';
            
            setTimeout(() => {
                document.getElementById('decision3').classList.remove('active');
                document.getElementById('decision3').classList.add('completed');
                document.getElementById('decision4').classList.add('active');
                document.getElementById('decision4').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 3000);
        }

        function calculateFinalScore() {
            const total = scores.reduce((a, b) => a + b, 0);
            document.getElementById('totalScore').textContent = total;
            
            let emoji, message;
            if (total >= 11) {
                emoji = 'üèÜ';
                message = '¬°EXCEPCIONAL! Dominas la creaci√≥n de met√°foras cl√≠nicas. Aplicaste correctamente todos los principios y demostraste comprensi√≥n profunda del an√°lisis funcional.';
            } else if (total >= 8) {
                emoji = 'üéØ';
                message = '¬°MUY BIEN! Tienes una comprensi√≥n s√≥lida de las met√°foras cl√≠nicas. Con un poco m√°s de pr√°ctica, perfeccionar√°s la t√©cnica.';
            } else if (total >= 5) {
                emoji = 'üìö';
                message = 'ACEPTABLE. Comprendes los conceptos b√°sicos, pero necesitas practicar m√°s la aplicaci√≥n de los 3 principios y el shifting.';
            } else {
                emoji = 'üîÑ';
                message = 'Necesitas repasar el contenido. Revisa especialmente los 3 principios y c√≥mo identificar la META funcionalmente relevante.';
            }
            
            document.getElementById('scoreEmoji').textContent = emoji;
            document.getElementById('scoreMessage').textContent = message;
            document.getElementById('scoreCard').classList.add('show');
            document.getElementById('finalBtn').classList.add('show');
            
            document.getElementById('scoreCard').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Check if all decisions are completed
        setInterval(() => {
            const allCompleted = scores.every((score, index) => {
                if (index === 0) return score > 0;
                if (index === 1) return score > 0;
                if (index === 2) return score > 0;
                if (index === 3) return score > 0;
                return true;
            });
            
            if (allCompleted && !document.getElementById('scoreCard').classList.contains('show')) {
                setTimeout(() => calculateFinalScore(), 1000);
            }
        }, 500);

        function nextModule() {
            if (navigator.vibrate) {
                navigator.vibrate(10);
            }
            alert('üéØ M√≥dulo Completado!\n\nPr√≥ximo: An√°lisis Funcional con Met√°foras\n(A‚ÜíB‚ÜíC Contingencias)\n\n(En desarrollo)');
            // window.location.href = 'modulo-analisis-funcional.html';
        }
    </script>
</body>
</html>
